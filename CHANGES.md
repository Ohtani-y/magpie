# ğŸ”„ å¤‰æ›´å±¥æ­´ã¨ã‚ªãƒªã‚¸ãƒŠãƒ«ã¨ã®å·®åˆ†

## ğŸ“… 2025å¹´1æœˆ27æ—¥ - 6ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆç”Ÿæˆãƒ»çµ±åˆæ©Ÿèƒ½è¿½åŠ 

### ğŸ¯ è¿½åŠ æ©Ÿèƒ½ã®æ¦‚è¦
DeepSeek R1ã‚’ä½¿ç”¨ã—ãŸ6ã¤ã®æ•°å­¦ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¥ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆç”Ÿæˆãƒ»çµ±åˆæ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚**ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã¯æœ€å°é™**ã«æŠ‘ãˆã€æ–°æ©Ÿèƒ½ã¯ç‹¬ç«‹ã—ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨ã—ã¦å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

### ğŸ“ æ–°è¦è¿½åŠ ãƒ•ã‚¡ã‚¤ãƒ«

#### 1. **scripts/magpie-deepseek-r1-domains.sh**
- **ç›®çš„**: ãƒ‰ãƒ¡ã‚¤ãƒ³ç‰¹åŒ–ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
- **ãƒ™ãƒ¼ã‚¹**: `magpie-deepseek-r1.sh`ã®æ‹¡å¼µç‰ˆ
- **å¤‰æ›´ç‚¹**: ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ ã€ãƒ­ã‚°å‡ºåŠ›ã«ãƒ‰ãƒ¡ã‚¤ãƒ³åè¿½åŠ 

```bash
# ä½¿ç”¨ä¾‹
./magpie-deepseek-r1-domains.sh algebra deepseek-ai/DeepSeek-R1 100
```

#### 2. **scripts/generate_all_domains.sh**
- **ç›®çš„**: 6ãƒ‰ãƒ¡ã‚¤ãƒ³ä¸€æ‹¬ç”Ÿæˆ
- **æ©Ÿèƒ½**: algebra, applied-mathematics, calculus, discrete-mathematics, geometry, number-theory
- **ç‰¹å¾´**: å®Œå…¨è‡ªå‹•åŒ–ã€ã‚¨ãƒ©ãƒ¼å‡¦ç†ä»˜ã

```bash
# ä½¿ç”¨ä¾‹
./generate_all_domains.sh
```

#### 3. **scripts/merge_domains.py**
- **ç›®çš„**: ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¥ãƒ‡ãƒ¼ã‚¿ã®çµ±åˆãƒ»ã‚·ãƒ£ãƒƒãƒ•ãƒ«
- **æ©Ÿèƒ½**: 
  - DeepSeek R1ãƒ•ã‚¡ã‚¤ãƒ«è‡ªå‹•æ¤œå‡º
  - æœ€å°é™ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è¿½åŠ 
  - ShareGPTå½¢å¼å¤‰æ›
- **å‡ºåŠ›**: JSON + JSONLå½¢å¼

```bash
# ä½¿ç”¨ä¾‹
python scripts/merge_domains.py --data_dir data --output_dir data
```

### ğŸ”§ ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®å¤‰æ›´

#### âŒ **å¤‰æ›´ã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«**
- `exp/gen_ins.py` - ãã®ã¾ã¾ä½¿ç”¨
- `exp/gen_res.py` - ãã®ã¾ã¾ä½¿ç”¨
- `configs/model_configs.json` - ãã®ã¾ã¾ä½¿ç”¨
- æ—¢å­˜ã®å…¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ - ãã®ã¾ã¾ä¿æŒ

#### âœ… **å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«**
- `README.md` - æ–°æ©Ÿèƒ½ã®èª¬æ˜ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¿½åŠ ã®ã¿

### ğŸ“Š ãƒ‡ãƒ¼ã‚¿å½¢å¼ã®å¤‰æ›´ç‚¹

#### **ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼ˆä¿æŒï¼‰**
```json
{
  "id": 0,
  "pre_query_template": "...",
  "instruction": "å•é¡Œæ–‡",
  "response": "è§£ç­”",
  "created": 1753420387,
  "gen_input_configs": {...},
  "gen_response_configs": {...}
}
```

#### **çµ±åˆå¾Œãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼ˆæœ€å°é™è¿½åŠ ï¼‰**
```json
{
  "id": 0,
  "pre_query_template": "...",    // å…ƒã®ã¾ã¾
  "instruction": "å•é¡Œæ–‡",         // å…ƒã®ã¾ã¾
  "response": "è§£ç­”",              // å…ƒã®ã¾ã¾
  "created": 1753420387,          // å…ƒã®ã¾ã¾
  "gen_input_configs": {...},     // å…ƒã®ã¾ã¾
  "gen_response_configs": {...},  // å…ƒã®ã¾ã¾
  "domain": "algebra",            // æ–°è¦è¿½åŠ ï¼ˆæœ€å°é™ï¼‰
  "source": "deepseek-r1",        // æ–°è¦è¿½åŠ ï¼ˆæœ€å°é™ï¼‰
  "dataset_version": "1.0"        // æ–°è¦è¿½åŠ ï¼ˆæœ€å°é™ï¼‰
}
```

### ğŸ”„ ShareGPTå½¢å¼ã¸ã®å¤‰æ›

#### **ShareGPTå‡ºåŠ›å½¢å¼**
```json
{
  "conversation_id": "deepseek-r1-math-0",
  "domain": "algebra",
  "source": "deepseek-r1",
  "conversations": [
    {"from": "human", "value": "å•é¡Œæ–‡"},
    {"from": "gpt", "value": "è§£ç­”"}
  ],
  "gen_input_configs": {...},      // å…ƒè¨­å®šå®Œå…¨ä¿æŒ
  "gen_response_configs": {...},   // å…ƒè¨­å®šå®Œå…¨ä¿æŒ
  "pre_query_template": "...",     // å…ƒè¨­å®šå®Œå…¨ä¿æŒ
  "created": 1753420387,           // å…ƒè¨­å®šå®Œå…¨ä¿æŒ
  "id": 0                          // å…ƒè¨­å®šå®Œå…¨ä¿æŒ
}
```

### ğŸ¯ è¨­è¨ˆæ€æƒ³

#### **æœ€å°é™å¤‰æ›´ã®åŸå‰‡**
1. **ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚³ãƒ¼ãƒ‰ã¯ä¸€åˆ‡å¤‰æ›´ã—ãªã„**
2. **æ–°æ©Ÿèƒ½ã¯ç‹¬ç«‹ã—ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å®Ÿè£…**
3. **æ—¢å­˜ãƒ‡ãƒ¼ã‚¿å½¢å¼ã¨ã®å®Œå…¨äº’æ›æ€§ç¶­æŒ**
4. **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è¿½åŠ ã¯æœ€å°é™ï¼ˆ3ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿ï¼‰**

#### **äº’æ›æ€§ã®ä¿è¨¼**
- æ—¢å­˜ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯å…¨ã¦æ­£å¸¸å‹•ä½œ
- æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¯å…¨ã¦èª­ã¿è¾¼ã¿å¯èƒ½
- æ–°æ©Ÿèƒ½ã¯æ—¢å­˜ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«å½±éŸ¿ãªã—

### ğŸ“ˆ å‡¦ç†ãƒ•ãƒ­ãƒ¼

```mermaid
graph TD
    A[æ—¢å­˜: magpie-deepseek-r1.sh] --> B[æ–°è¦: magpie-deepseek-r1-domains.sh]
    B --> C[æ–°è¦: generate_all_domains.sh]
    C --> D[6ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¥ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ]
    D --> E[æ–°è¦: merge_domains.py]
    E --> F[çµ±åˆãƒ»ã‚·ãƒ£ãƒƒãƒ•ãƒ«]
    F --> G[ShareGPTå½¢å¼å¤‰æ›]
    
    style A fill:#e1f5fe
    style B fill:#f3e5f5
    style C fill:#f3e5f5
    style E fill:#fff3e0
```

### ğŸš¨ æ³¨æ„äº‹é …

1. **å®Ÿè¡Œé †åº**: å¿…ãš`generate_all_domains.sh`ã‚’å…ˆã«å®Ÿè¡Œ
2. **æ¨©é™è¨­å®š**: ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«å®Ÿè¡Œæ¨©é™ä»˜ä¸ãŒå¿…è¦ï¼ˆ`chmod +x *.sh`ï¼‰
3. **GPUè¦ä»¶**: DeepSeek R1ã¯tensor_parallel=4æ¨å¥¨
4. **ãƒ‡ãƒ¼ã‚¿ä¿å­˜**: `data/`ãƒ•ã‚©ãƒ«ãƒ€ã«è‡ªå‹•ä¿å­˜

### ğŸ” æ¤œè¨¼æ–¹æ³•

```bash
# 1. ç”Ÿæˆãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª
ls data/DeepSeek-R1-*/

# 2. çµ±åˆãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª
python -c "import json; print(len(json.load(open('data/DeepSeek-R1-Math-Combined-*.json'))))"

# 3. ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ†å¸ƒã®ç¢ºèª
python -c "
import json
data = json.load(open('data/DeepSeek-R1-Math-Combined-*.json'))
domains = {}
for item in data:
    domains[item['domain']] = domains.get(item['domain'], 0) + 1
print(domains)
"
```

### ğŸ“ ä»Šå¾Œã®æ‹¡å¼µå¯èƒ½æ€§

1. **ãƒ‰ãƒ¡ã‚¤ãƒ³è¿½åŠ **: æ–°ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯`generate_all_domains.sh`ã«è¿½åŠ ã™ã‚‹ã ã‘
2. **ãƒ¢ãƒ‡ãƒ«å¤‰æ›´**: `magpie-deepseek-r1-domains.sh`ã®ãƒ¢ãƒ‡ãƒ«ãƒ‘ã‚¹å¤‰æ›´
3. **å“è³ªè©•ä¾¡**: æ—¢å­˜ã®`unitag.py`ã‚’æ´»ç”¨å¯èƒ½
4. **ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: æ—¢å­˜ã®`data_filter.ipynb`ã‚’æ´»ç”¨å¯èƒ½

ã“ã®å®Ÿè£…ã«ã‚ˆã‚Šã€ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å®Œå…¨æ€§ã‚’ä¿ã¡ãªãŒã‚‰ã€6ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆç”Ÿæˆãƒ»çµ±åˆæ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚